<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.domaindns.admin.mapper.AdminUserMapper">
	<resultMap id="UserMap" type="com.domaindns.admin.model.AdminUser">
		<id property="id" column="id" />
		<result property="username" column="username" />
		<result property="email" column="email" />
		<result property="displayName" column="display_name" />
		<result property="points" column="points" />
		<result property="role" column="role" />
		<result property="status" column="status" />
		<result property="ipAddress" column="ip_address" />
		<result property="createdAt" column="created_at" />
	</resultMap>

	<select id="list" resultMap="UserMap">
		SELECT id,username,email,display_name,points,role,status,ip_address,created_at FROM users
		<where>
			<if test="status!=null">status=#{status}</if>
			<if test="role!=null and role!=''">
				<if test="status!=null"> AND </if>
				role=#{role}
			</if>
		</where>
		ORDER BY id DESC
		<if test="size!=null"> LIMIT #{offset}, #{size}</if>
	</select>

	<select id="count" resultType="int">
		SELECT COUNT(1) FROM users
		<where>
			<if test="status!=null">status=#{status}</if>
			<if test="role!=null and role!=''">
				<if test="status!=null"> AND </if>
				role=#{role}
			</if>
		</where>
	</select>

	<update id="adjustPoints">
		UPDATE users SET points = points + #{delta} WHERE id=#{id}
	</update>

	<select id="findById" parameterType="long" resultMap="UserMap">
		SELECT id,username,email,display_name,points,role,status,ip_address,created_at FROM users WHERE id = #{id}
	</select>

	<update id="updateStatus">
		UPDATE users SET status = #{status} WHERE id = #{id}
	</update>

	<update id="updateRole">
		UPDATE users SET role = #{role} WHERE id = #{id}
	</update>
</mapper>
